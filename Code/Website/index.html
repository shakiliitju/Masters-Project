<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Credit Card Fraud Detection Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #e0f7fa 0%, #b3e5fc 100%);
            /* Icy blue gradient */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #0d47a1;
            margin-top: 40px;
            text-shadow: 0 2px 8px rgba(255,255,255,0.4);
        }
        input[type="file"] {
            margin: 30px 0 40px 0;
            padding: 12px 20px;
            border-radius: 12px;
            border: none;
            background: rgba(255,255,255,0.4);
            box-shadow: 0 4px 24px rgba(30,144,255,0.10);
            backdrop-filter: blur(6px);
            font-size: 1rem;
            cursor: pointer;
        }
        #dashboard {
            width: 100vw;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
            padding-top: 50px;
        }
        .dashboard-section {
            width: 40%;
            min-width: 340px;
            background: rgba(255,255,255,0.18);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1.5px solid rgba(255,255,255,0.28);
            padding: 32px 24px 24px 24px;
            margin-bottom: 0;
            margin-top: 0;
            transition: box-shadow 0.2s;
        }
        .dashboard-section:hover {
            box-shadow: 0 12px 36px 0 rgba(31, 38, 135, 0.24);
        }
        .dashboard-section h2 {
            color: #1976d2;
            margin-top: 0;
            margin-bottom: 18px;
            text-shadow: 0 1px 6px rgba(255,255,255,0.3);
            font-weight: 600;
        }
        .plot-container {
            margin-top: 12px;
        }
        @media (max-width: 900px) {
            .dashboard-section {
                width: 90%;
                margin: 0 auto 32px auto;
            }
            #dashboard {
                gap: 24px;
            }
        }
    </style>
</head>
<body>
    <h1>ðŸ“Š Credit Card Fraud Detection Dashboard</h1>
    <input type="file" id="csvFile" accept=".csv" />
    <div id="dashboard">
        <div class="dashboard-section">
            <h2>1. Fraudulent vs. Non-Fraudulent Transactions</h2>
            <div id="class-distribution" class="plot-container"></div>
        </div>
        <div class="dashboard-section">
            <h2>2. Transaction Amount Distribution</h2>
            <div id="amount-distribution" class="plot-container"></div>
        </div>
        <div class="dashboard-section">
            <h2>3. Time-Based Trends</h2>
            <div id="time-trends" class="plot-container"></div>
        </div>
        <div class="dashboard-section">
            <h2>4. Correlation Heatmap of Features</h2>
            <div id="correlation-heatmap" class="plot-container"></div>
        </div>
        <div class="dashboard-section">
            <h2>5. Top Contributing Features for Fraudulent Transactions</h2>
            <div id="feature-importance" class="plot-container"></div>
        </div>
    </div>
    <script>
    document.getElementById('csvFile').addEventListener('change', function (e) {
        if (!e.target.files.length) return;
        Papa.parse(e.target.files[0], {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            complete: function(results) {
                const data = results.data;
                renderDashboard(data);
            }
        });
    });

    function renderDashboard(data) {
        // Extract columns
        const columns = Object.keys(data[0]);
        const amountCol = columns.find(c => c.toLowerCase() === 'amount');
        const classCol = columns.find(c => c.toLowerCase() === 'class');
        const timeCol = columns.find(c => c.toLowerCase() === 'time');
        const featureCols = columns.filter(c => /^v\d+$/i.test(c));

        // 1. Class Distribution
        const classCounts = data.reduce((acc, row) => {
            acc[row[classCol]] = (acc[row[classCol]] || 0) + 1;
            return acc;
        }, {});
        Plotly.newPlot('class-distribution', [{
            x: Object.keys(classCounts).map(cl => cl == 1 ? 'Fraudulent' : 'Non-Fraudulent'),
            y: Object.values(classCounts),
            type: 'bar',
            marker: { color: ['#2ecc40', '#ff4136'] }
        }], {
            title: 'Transaction Class Distribution',
            xaxis: { title: 'Class' },
            yaxis: { title: 'Count' },
            paper_bgcolor: 'rgba(255,255,255,0.0)',
            plot_bgcolor: 'rgba(255,255,255,0.0)'
        });

        // 2. Transaction Amount Distribution
        const amounts = data.map(row => row[amountCol]);
        const classes = data.map(row => row[classCol]);
        Plotly.newPlot('amount-distribution', [
            {
                x: amounts.filter((_, i) => classes[i] == 0),
                type: 'histogram',
                name: 'Non-Fraudulent',
                marker: { color: '#2ecc40' },
                opacity: 0.7
            },
            {
                x: amounts.filter((_, i) => classes[i] == 1),
                type: 'histogram',
                name: 'Fraudulent',
                marker: { color: '#ff4136' },
                opacity: 0.7
            }
        ], {
            barmode: 'overlay',
            title: 'Transaction Amount Distribution',
            xaxis: { title: 'Amount' },
            yaxis: { title: 'Count' },
            paper_bgcolor: 'rgba(255,255,255,0.0)',
            plot_bgcolor: 'rgba(255,255,255,0.0)'
        });

        // 3. Time-Based Trends
        let timeBuckets = {};
        data.forEach(row => {
            let bucket = Math.floor(row[timeCol] / 3600); // hourly buckets
            if (!timeBuckets[bucket]) timeBuckets[bucket] = { fraud: 0, nonfraud: 0 };
            if (row[classCol] == 1) timeBuckets[bucket].fraud++;
            else timeBuckets[bucket].nonfraud++;
        });
        const buckets = Object.keys(timeBuckets).map(Number).sort((a, b) => a - b);
        Plotly.newPlot('time-trends', [
            {
                x: buckets,
                y: buckets.map(b => timeBuckets[b].nonfraud),
                type: 'scatter',
                mode: 'lines',
                name: 'Non-Fraudulent',
                line: { color: '#2ecc40' }
            },
            {
                x: buckets,
                y: buckets.map(b => timeBuckets[b].fraud),
                type: 'scatter',
                mode: 'lines',
                name: 'Fraudulent',
                line: { color: '#ff4136' }
            }
        ], {
            title: 'Transactions Over Time (Hourly Buckets)',
            xaxis: { title: 'Hour' },
            yaxis: { title: 'Count' },
            paper_bgcolor: 'rgba(255,255,255,0.0)',
            plot_bgcolor: 'rgba(255,255,255,0.0)'
        });

        // 4. Correlation Heatmap (V1-V28 + Amount + Class)
        function computeCorrelationMatrix(data, features) {
            function mean(arr) { return arr.reduce((a, b) => a + b, 0) / arr.length; }
            function std(arr, m) { return Math.sqrt(arr.reduce((a, b) => a + Math.pow(b - m, 2), 0) / arr.length); }
            function corr(x, y) {
                const mx = mean(x), my = mean(y);
                const sx = std(x, mx), sy = std(y, my);
                const cov = x.reduce((a, xi, i) => a + (xi - mx) * (y[i] - my), 0) / x.length;
                return cov / (sx * sy);
            }
            let matrix = [];
            for (let i = 0; i < features.length; i++) {
                matrix[i] = [];
                for (let j = 0; j < features.length; j++) {
                    const xi = data.map(row => row[features[i]]);
                    const xj = data.map(row => row[features[j]]);
                    matrix[i][j] = corr(xi, xj);
                }
            }
            return matrix;
        }
        const heatmapFeatures = [...featureCols, amountCol, classCol];
        const corrMatrix = computeCorrelationMatrix(data, heatmapFeatures);
        Plotly.newPlot('correlation-heatmap', [{
            z: corrMatrix,
            x: heatmapFeatures,
            y: heatmapFeatures,
            type: 'heatmap',
            colorscale: 'RdBu',
            zmin: -1, zmax: 1,
            colorbar: { title: 'Correlation' }
        }], {
            title: 'Correlation Heatmap',
            xaxis: { side: 'top' },
            paper_bgcolor: 'rgba(255,255,255,0.0)',
            plot_bgcolor: 'rgba(255,255,255,0.0)'
        });

        // 5. Top Contributing Features for Fraudulent Transactions
        let fraudRows = data.filter(row => row[classCol] == 1);
        let nonFraudRows = data.filter(row => row[classCol] == 0);
        let featureDiffs = featureCols.map(f => {
            let meanFraud = fraudRows.reduce((a, r) => a + r[f], 0) / (fraudRows.length || 1);
            let meanNonFraud = nonFraudRows.reduce((a, r) => a + r[f], 0) / (nonFraudRows.length || 1);
            return { feature: f, diff: Math.abs(meanFraud - meanNonFraud) };
        });
        featureDiffs.sort((a, b) => b.diff - a.diff);
        let topFeatures = featureDiffs.slice(0, 10);
        Plotly.newPlot('feature-importance', [{
            x: topFeatures.map(f => f.feature),
            y: topFeatures.map(f => f.diff),
            type: 'bar',
            marker: { color: '#0074D9' }
        }], {
            title: 'Top 10 Features Differentiating Fraudulent Transactions',
            xaxis: { title: 'Feature' },
            yaxis: { title: 'Mean Difference' },
            paper_bgcolor: 'rgba(255,255,255,0.0)',
            plot_bgcolor: 'rgba(255,255,255,0.0)'
        });
    }
    </script>
</body>
</html>
